rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // Fichiers dans le dossier 'uploads'
    match /uploads/{uid}/{fileId} {

      // Un utilisateur authentifié peut lire ses propres fichiers.
      allow read: if request.auth != null && request.auth.uid == uid;

      // Un utilisateur authentifié peut écrire dans son propre dossier si :
      // 1. Il est bien le propriétaire du dossier (son uid correspond).
      // 2. Le fichier n'est pas trop gros (moins de 10 Mo).
      // 3. Le type de fichier est bien une image.
      allow write: if request.auth != null 
                    && request.auth.uid == uid
                    && request.resource.size < 10 * 1024 * 1024
                    && request.resource.contentType.matches('image/.*');
    }
  }
}
