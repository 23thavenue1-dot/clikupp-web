rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Fichiers téléversés par les utilisateurs
    // Le chemin doit correspondre exactement à celui construit dans le code client.
    match /uploads/{uid}/{fileId} {

      // Un utilisateur ne peut lire que ses propres fichiers.
      allow read: if request.auth != null && request.auth.uid == uid;

      // Un utilisateur ne peut écrire que dans son propre dossier.
      // On ajoute des gardes-fous supplémentaires.
      allow write: if request.auth != null
                    && request.auth.uid == uid
                    // Limiter la taille du fichier à 10 Mo
                    && request.resource.size < 10 * 1024 * 1024
                    // S'assurer que le fichier est bien une image
                    && request.resource.contentType.matches('image/.*');
    }
  }
}
